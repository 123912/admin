import{b3 as w,a as me,r as i,O as pe,o as ce,b4 as fe,f as U,s as B,y as e,w as t,k as o,a$ as h,R as m,h as _e,g as A,j as R,t as G,p as ve,F as M,ad as ge,ak as $,b5 as E,S as be,U as ye,V as he,b0 as we,W as Ve,X as Ce,Y as ke}from"./index-537f057f.js";import{E as xe,a as Ue,b as Ee,c as Se,d as ze}from"./el-table-column-efe7b014.js";import{E as Re}from"./el-drawer-88b8f2bd.js";import"./el-overlay-80a7d957.js";import{E as Ie}from"./el-pagination-557c4079.js";/* empty css                   */import{E as qe}from"./el-button-caa9e001.js";import{u as Ne}from"./setting-1e37dc8b.js";import"./vnode-4c4dc2d3.js";const Ae=(n,S,d)=>w.get(`/admin/acl/user/${n}/${S}/?username=${d}`),De=n=>n.id?w.put("/admin/acl/user/update",n):w.post("/admin/acl/user/save",n),Oe=n=>w.get("/admin/acl/user/toAssign/"+n),Pe=n=>w.post("/admin/acl/user/doAssignRole",n),Te=n=>w.delete("/admin/acl/user/remove/"+n),je=n=>w.delete("/admin/acl/user/batchRemove",{data:n}),Le=n=>(Ve("data-v-3cdea624"),n=n(),Ce(),n),Fe={style:{flex:"auto"}},Be=Le(()=>R("h4",null,"分配角色",-1)),Ge={style:{flex:"auto"}},Me=me({__name:"index",setup(n){let S=Ne(),d=i(1),C=i(5),D=i(0),z=i([]),c=i(!1),V=i(!1),_=i(),v=i(""),k=i(!1),I=i(!0),x=i([]),g=i([]),s=pe({username:"",name:"",password:""}),q=i([]);ce(()=>{b()});const b=async(r=1)=>{d.value=r;let l=await Ae(d.value,C.value,v.value);l.code==200&&(D.value=l.data.total,z.value=l.data.records)},H=()=>{b()},W=()=>{c.value=!0,Object.assign(s,{username:"",name:"",password:""}),$(()=>{_.value.clearValidate("username"),_.value.clearValidate("name"),_.value.clearValidate("password")})},X=r=>{c.value=!0,Object.assign(s,r),$(()=>{_.value.clearValidate("username"),_.value.clearValidate("name")})},Y=async()=>{await _.value.validate(),(await De(s)).code==200?(c.value=!1,E({type:"success",message:s.id?"更新成功":"添加成功"}),window.location.reload()):(c.value=!1,E({type:"error",message:s.id?"更新失败":"添加失败"}))},O=()=>{c.value=!1},J={username:[{required:!0,trigger:"blur",validator:(r,l,u)=>{l.trim().length>=5?u():u(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(r,l,u)=>{l.trim().length>=5?u():u(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(r,l,u)=>{l.trim().length>=6?u():u(new Error("用户密码至少六位"))}}]},K=async r=>{Object.assign(s,r);let l=await Oe(s.id);l.code==200&&(x.value=l.data.allRolesList,g.value=l.data.assignRoles,V.value=!0)},Q=r=>{g.value=r?x.value:[],I.value=!1},Z=r=>{k.value=r.length===x.value.length,I.value=r.length!==x.value.length},ee=async()=>{let r={userId:s.id,roleIdList:g.value.map(u=>u.id)};(await Pe(r)).code==200&&(E({type:"success",message:"分配职务成功"}),V.value=!1,b(d.value))},le=async r=>{(await Te(r)).code==200&&(E({type:"success",message:"删除成功"}),b(z.value.length>1?d.value:d.value-1))},ae=r=>{q.value=r},te=async()=>{let r=q.value.map(u=>u.id);(await je(r)).code==200&&(E({type:"success",message:"删除成功"}),b(z.value.length>1?d.value:d.value-1))},oe=()=>{b(),v.value=""},re=()=>{S.refsh=!S.refsh};return(r,l)=>{const u=be,y=ye,p=qe,N=he,P=we,f=xe,se=Ue,ne=Ee,ue=Ie,T=Re,j=Se,de=ze,ie=fe("has");return U(),B(M,null,[e(P,{style:{height:"80px"}},{default:t(()=>[e(N,{inline:!0,class:"form"},{default:t(()=>[e(y,{label:"用户名:"},{default:t(()=>[e(u,{placeholder:"请你输入搜索用户名",modelValue:o(v),"onUpdate:modelValue":l[0]||(l[0]=a=>h(v)?v.value=a:v=a)},null,8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(p,{type:"primary",size:"default",disabled:!o(v),onClick:oe},{default:t(()=>[m("搜索")]),_:1},8,["disabled"]),e(p,{type:"primary",size:"default",onClick:re},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),e(P,{style:{margin:"10px 0px"}},{default:t(()=>[_e((U(),A(p,{type:"primary",size:"default",onClick:W},{default:t(()=>[m("添加用户")]),_:1})),[[ie,"btn.User.add"]]),e(p,{type:"primary",size:"default",onClick:te,disabled:!o(q).length},{default:t(()=>[m("批量删除")]),_:1},8,["disabled"]),e(ne,{style:{margin:"10px 0px"},border:"",data:o(z),onSelectionChange:ae},{default:t(()=>[e(f,{type:"selection",align:"center"}),e(f,{label:"#",align:"center",type:"index"}),e(f,{label:"ID",align:"center",prop:"id"}),e(f,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),e(f,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),e(f,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(f,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(f,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(f,{label:"操作",width:"300px",align:"center"},{default:t(({row:a,$index:L})=>[e(p,{type:"primary",size:"small",icon:"User",onClick:F=>K(a)},{default:t(()=>[m("分配角色")]),_:2},1032,["onClick"]),e(p,{type:"primary",size:"small",icon:"Edit",onClick:F=>X(a)},{default:t(()=>[m("编辑")]),_:2},1032,["onClick"]),e(se,{title:`你确定要删除${a.username}`,width:"200px",onConfirm:F=>le(a.id)},{reference:t(()=>[e(p,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(ue,{"current-page":o(d),"onUpdate:currentPage":l[1]||(l[1]=a=>h(d)?d.value=a:d=a),"page-size":o(C),"onUpdate:pageSize":l[2]||(l[2]=a=>h(C)?C.value=a:C=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:o(D),onSizeChange:H,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1}),e(T,{modelValue:o(c),"onUpdate:modelValue":l[6]||(l[6]=a=>h(c)?c.value=a:c=a)},{header:t(()=>[R("h4",null,G(o(s).id?"更新用户":"添加用户"),1)]),default:t(()=>[e(N,{model:o(s),rules:J,ref_key:"formRef",ref:_},{default:t(()=>[e(y,{label:"用户姓名",prop:"username"},{default:t(()=>[e(u,{placeholder:"请您输入用户姓名",modelValue:o(s).username,"onUpdate:modelValue":l[3]||(l[3]=a=>o(s).username=a)},null,8,["modelValue"])]),_:1}),e(y,{label:"用户昵称",prop:"name"},{default:t(()=>[e(u,{placeholder:"请您输入用户昵称",modelValue:o(s).name,"onUpdate:modelValue":l[4]||(l[4]=a=>o(s).name=a)},null,8,["modelValue"])]),_:1}),o(s).id?ve("",!0):(U(),A(y,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[e(u,{placeholder:"请您输入用户密码",modelValue:o(s).password,"onUpdate:modelValue":l[5]||(l[5]=a=>o(s).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[R("div",Fe,[e(p,{onClick:O},{default:t(()=>[m("取消")]),_:1}),e(p,{type:"primary",onClick:Y},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"]),e(T,{modelValue:o(V),"onUpdate:modelValue":l[10]||(l[10]=a=>h(V)?V.value=a:V=a)},{header:t(()=>[Be]),default:t(()=>[e(N,{model:o(s)},{default:t(()=>[e(y,{label:"用户姓名"},{default:t(()=>[e(u,{modelValue:o(s).username,"onUpdate:modelValue":l[7]||(l[7]=a=>o(s).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),e(y,{label:"职位列表"},{default:t(()=>[e(j,{modelValue:o(k),"onUpdate:modelValue":l[8]||(l[8]=a=>h(k)?k.value=a:k=a),indeterminate:o(I),onChange:Q},{default:t(()=>[m(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),e(de,{modelValue:o(g),"onUpdate:modelValue":l[9]||(l[9]=a=>h(g)?g.value=a:g=a),onChange:Z},{default:t(()=>[(U(!0),B(M,null,ge(o(x),(a,L)=>(U(),A(j,{key:L,label:a},{default:t(()=>[m(G(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),footer:t(()=>[R("div",Ge,[e(p,{onClick:O},{default:t(()=>[m("取消")]),_:1}),e(p,{type:"primary",onClick:ee},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const tl=ke(Me,[["__scopeId","data-v-3cdea624"]]);export{tl as default};
