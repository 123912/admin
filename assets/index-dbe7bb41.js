import{b3 as L,a as W,r as p,O as ve,f,g as h,w as t,y as e,k as n,s as K,F as q,ad as F,j as H,R as B,bd as ye,b5 as P,S as ne,U as ue,bi as oe,bj as se,V as re,c as be,av as Ve,a$ as O,t as Ie,E as ke,bh as Ae,bc as Ue,a5 as he,ar as xe,h as Y,v as Q,bg as we,b0 as Ce,Y as Ne}from"./index-537f057f.js";import{E as de}from"./el-dialog-572bb7ad.js";import"./el-overlay-80a7d957.js";import{E as Pe}from"./el-pagination-557c4079.js";import{E as X,b as Z,a as ie}from"./el-table-column-efe7b014.js";/* empty css                   */import{E as ee}from"./el-button-caa9e001.js";import{E as Le}from"./el-progress-472b4673.js";/* empty css                */import"./refs-044d52ff.js";import"./vnode-4c4dc2d3.js";const Ee=(g,k,v)=>L.get(`/admin/product/${g}/${k}?category3Id=${v}`),te=()=>L.get("/admin/product/baseTrademark/getTrademarkList"),pe=g=>L.get("/admin/product/spuImageList/"+g),ce=g=>L.get("/admin/product/spuSaleAttrList/"+g),ae=()=>L.get("/admin/product/baseSaleAttrList"),ze=g=>g.id?L.post("/admin/product/updateSpuInfo",g):L.post("/admin/product/saveSpuInfo",g),$e=g=>L.post("/admin/product/updateSkuInfo",g),De=g=>L.get("/admin/product/findBySpuId/"+g),Ke=g=>L.delete("/admin/product/deleteSpu/"+g),qe=["src"],Be=W({__name:"skuForm",emits:["changeScene"],setup(g,{expose:k,emit:v}){let y=p(),U=p([]),x=p([]),I=p([]),s=ve({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const z=()=>{v("changeScene",{flag:0,params:""})},i=async(C,r,d)=>{s.category3Id=d.category3Id,s.spuId=d.id,s.tmId=d.tmId;let c=await ye(C,r,d.category3Id),A=await ce(d.id),$=await pe(d.id);U.value=c.data,x.value=A.data,I.value=$.data},b=C=>{I.value.forEach(r=>{y.value.toggleRowSelection(r,!1)}),y.value.toggleRowSelection(C,!0),s.skuDefaultImg=C.imgUrl},w=async()=>{s.skuAttrValueList=U.value.reduce((r,d)=>{if(d.attrIdAndValueId){let[c,A]=d.attrIdAndValueId.split(":");r.push({attrId:c,valueId:A})}return r},[]),s.skuSaleAttrValueList=x.value.reduce((r,d)=>{if(d.saleIdAndValueId){let[c,A]=d.saleIdAndValueId.split(":");r.push({saleAttrId:c,saleAttrValueId:A})}return r},[]),(await $e(s)).code==200?(P({type:"success",message:"添加SKU成功"}),v("changeScene",{flag:0,params:""})):P({type:"error",message:"添加SKU失败"})};return k({initSkuData:i}),(C,r)=>{const d=ne,c=ue,A=oe,$=se,T=re,m=X,_=ee,G=Z;return f(),h(T,{"label-width":"100px"},{default:t(()=>[e(c,{label:"SKU名称"},{default:t(()=>[e(d,{placeholder:"请输入SKU名称",modelValue:n(s).skuName,"onUpdate:modelValue":r[0]||(r[0]=l=>n(s).skuName=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"价格（元）"},{default:t(()=>[e(d,{type:"number",placeholder:"价格（元）",modelValue:n(s).price,"onUpdate:modelValue":r[1]||(r[1]=l=>n(s).price=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"重量（g）"},{default:t(()=>[e(d,{type:"number",placeholder:"重量（g）",modelValue:n(s).weight,"onUpdate:modelValue":r[2]||(r[2]=l=>n(s).weight=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"SKU描述"},{default:t(()=>[e(d,{type:"textarea",placeholder:"SKU描述",modelValue:n(s).skuDesc,"onUpdate:modelValue":r[3]||(r[3]=l=>n(s).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"平台属性"},{default:t(()=>[e(T,{inline:!0,"label-width":"100px"},{default:t(()=>[(f(!0),K(q,null,F(n(U),(l,a)=>(f(),h(c,{key:l.id,label:l.attrName},{default:t(()=>[e($,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":u=>l.attrIdAndValueId=u},{default:t(()=>[(f(!0),K(q,null,F(l.attrValueList,(u,V)=>(f(),h(A,{key:u.id,label:u.valueName,value:`${l.id}:${u.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(c,{label:"销售属性"},{default:t(()=>[e(T,{inline:!0},{default:t(()=>[(f(!0),K(q,null,F(n(x),(l,a)=>(f(),h(c,{key:l.id,label:l.saleAttrName},{default:t(()=>[e($,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":u=>l.saleIdAndValueId=u},{default:t(()=>[(f(!0),K(q,null,F(l.spuSaleAttrValueList,(u,V)=>(f(),h(A,{key:u.id,label:u.saleAttrValueName,value:`${l.id}:${u.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(c,{label:"图片名称"},{default:t(()=>[e(G,{border:"",data:n(I),ref_key:"table",ref:y},{default:t(()=>[e(m,{type:"selection",width:"80",align:"center"}),e(m,{prop:"saleAttrName",label:"图片"},{default:t(({row:l,$index:a})=>[H("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,qe)]),_:1}),e(m,{prop:"imgName",label:"名称"}),e(m,{label:"操作"},{default:t(({row:l,$index:a})=>[e(_,{type:"primary",size:"small",onClick:u=>b(l)},{default:t(()=>[B("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(c,null,{default:t(()=>[e(_,{type:"primary",size:"default",onClick:w},{default:t(()=>[B("保存")]),_:1}),e(_,{type:"primary",size:"default",onClick:z},{default:t(()=>[B("取消")]),_:1})]),_:1})]),_:1})}}}),Te=["src"],Fe=W({__name:"spuForm",emits:["changeScene"],setup(g,{expose:k,emit:v}){const y=p(""),U=p(!1);let x=p([]),I=p([]),s=p([]),z=p([]),i=p({spuName:"",description:"",category3Id:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),b=p("");const w=()=>{v("changeScene",{flag:0,params:"update"})},C=async l=>{i.value=l;let a=await te(),u=await pe(l.id),V=await ce(l.id),D=await ae();console.log(a,u,V,D),x.value=a.data,I.value=u.data.map(E=>({name:E.imgName,url:E.imgUrl})),s.value=V.data,z.value=D.data},r=l=>{y.value=l.url,U.value=!0},d=()=>{console.log(123)},c=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(P({type:"error",message:"上传文件需小于3m"}),!1):(P({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let A=be(()=>z.value.filter(a=>s.value.every(u=>a.name!=u.saleAttrName)));const $=()=>{const[l,a]=b.value.split(":");let u={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};s.value.push(u),b.value=""},T=l=>{l.flag=!0,l.saleAttrValue=""},m=l=>{const{baseSaleAttrId:a,saleAttrValue:u}=l;let V={baseSaleAttrId:a,saleAttrValueName:u};if(u.trim()==""){P({type:"error",message:"属性值不能为空"});return}if(l.spuSaleAttrValueList.find(E=>E.saleAttrValueName==u)){P({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(V),l.flag=!1},_=async()=>{i.value.spuImageList=I.value.map(a=>({imgName:a.name,imgUrl:a.response&&a.response.data||a.url})),i.value.spuSaleAttrList=s.value,(await ze(i.value)).code==200?(P({type:"success",message:i.value.id?"更新成功":"添加成功"}),v("changeScene",{flag:0,params:i.value.id?"update":"add"})):P({type:"error",message:i.value.id?"更新失败":"添加失败"})};return k({initHasSpuData:C,initAddSpu:async l=>{Object.assign(i.value,{spuName:"",description:"",category3Id:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),I.value=[],s.value=[],b.value="",i.value.category3Id=l;let a=await te();x.value=a.data;let u=await ae();z.value=u.data}}),(l,a)=>{const u=ne,V=ue,D=oe,E=se,J=Ve("Plus"),S=ke,R=Le,me=de,j=ee,M=X,_e=Ae,fe=ie,ge=Z,Se=re;return f(),h(Se,{model:n(i),"label-width":"100px"},{default:t(()=>[e(V,{label:"SPU名称"},{default:t(()=>[e(u,{modelValue:n(i).spuName,"onUpdate:modelValue":a[0]||(a[0]=o=>n(i).spuName=o),placeholder:"请输入SPU名称"},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU品牌"},{default:t(()=>[e(E,{modelValue:n(i).tmId,"onUpdate:modelValue":a[1]||(a[1]=o=>n(i).tmId=o),placeholder:"please select your zone"},{default:t(()=>[(f(!0),K(q,null,F(n(x),(o,N)=>(f(),h(D,{label:o.tmName,value:o.id,key:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU描述"},{default:t(()=>[e(u,{modelValue:n(i).description,"onUpdate:modelValue":a[2]||(a[2]=o=>n(i).description=o),type:"textarea",placeholder:"请输入SPU描述"},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU图标"},{default:t(()=>[e(R,{"file-list":n(I),"onUpdate:fileList":a[3]||(a[3]=o=>O(I)?I.value=o:I=o),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":r,"on-remove":d,"before-upload":c},{default:t(()=>[e(S,null,{default:t(()=>[e(J)]),_:1})]),_:1},8,["file-list"]),e(me,{modelValue:U.value,"onUpdate:modelValue":a[4]||(a[4]=o=>U.value=o)},{default:t(()=>[H("img",{"w-full":"",src:y.value,alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Te)]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU销售属性"},{default:t(()=>[e(E,{modelValue:n(b),"onUpdate:modelValue":a[5]||(a[5]=o=>O(b)?b.value=o:b=o),placeholder:n(A).length?`还未选择${n(A).length}个`:"无"},{default:t(()=>[(f(!0),K(q,null,F(n(A),(o,N)=>(f(),h(D,{key:o.id,label:o.name,value:`${o.id}:${o.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(j,{onClick:$,disabled:!n(b),type:"primary",size:"default",icon:"Plus",style:{"margin-left":"10px"}},{default:t(()=>[B("添加属性")]),_:1},8,["disabled"]),e(ge,{data:n(s),border:"",style:{width:"100%",margin:"10px 0"}},{default:t(()=>[e(M,{label:"序号",type:"index",width:"80",align:"center"}),e(M,{prop:"saleAttrName",width:"120",label:"销售属性名称"}),e(M,{label:"销售属性值"},{default:t(({row:o})=>[(f(!0),K(q,null,F(o.spuSaleAttrValueList,(N,le)=>(f(),h(_e,{style:{margin:"0 5px"},key:N.id,class:"mx-1",closable:"",onClose:He=>o.spuSaleAttrValueList.splice(le,1)},{default:t(()=>[B(Ie(N.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag==!0?(f(),h(u,{key:0,placeholder:"请输入属性值",ref:"InputRef",modelValue:o.saleAttrValue,"onUpdate:modelValue":N=>o.saleAttrValue=N,style:{width:"100px"},size:"small",onBlur:N=>m(o)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(f(),h(j,{key:1,icon:"Plus",type:"primary",size:"small",onClick:N=>T(o)},null,8,["onClick"]))]),_:1}),e(M,{width:"120",label:"操作"},{default:t(({row:o,$index:N})=>[e(fe,{title:"您确认要删除这个销售属性吗?",width:"250px",icon:"Delete",onConfirm:le=>n(s).splice(N,1)},{reference:t(()=>[e(j,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),e(V,null,{default:t(()=>[e(j,{type:"primary",size:"default",onClick:_,disabled:!(n(s).length>0)},{default:t(()=>[B("保存")]),_:1},8,["disabled"]),e(j,{type:"primary",size:"default",style:{"margin-left":"10px"},onClick:w},{default:t(()=>[B("取消")]),_:1})]),_:1})]),_:1},8,["model"])}}}),Re=["src"],je=W({__name:"index",setup(g){let k=Ue(),v=p(0),y=p(1),U=p(3),x=p(0),I=p([]),s=p(),z=p(),i=p([]),b=p(!1);he(()=>k.c3Id,()=>{k.c3Id&&w()});const w=async(m=1)=>{y.value=m;let _=await Ee(y.value,U.value,k.c3Id);_.code==200&&(I.value=_.data.records,x.value=_.data.total)},C=()=>{w()},r=()=>{v.value=1,s.value.initAddSpu(k.c3Id)},d=m=>{v.value=m.flag,m.params=="update"?w(y.value):w()},c=m=>{v.value=1,s.value.initHasSpuData(m)},A=m=>{v.value=2,z.value.initSkuData(k.c1Id,k.c2Id,m)},$=async m=>{let _=await De(m.id);_.code==200&&(i.value=_.data,b.value=!0)},T=async m=>{(await Ke(m.id)).code==200?(P({type:"success",message:"删除成功"}),w(I.value.length>1?y.value:y.value-1)):P({type:"error",message:"删除失败"})};return xe(()=>{k.$reset()}),(m,_)=>{const G=we,l=ee,a=X,u=ie,V=Z,D=Pe,E=Ce,J=de;return f(),K(q,null,[H("div",null,[e(G,{scene:n(v)},null,8,["scene"]),e(E,{style:{margin:"10px 0"}},{default:t(()=>[Y(H("div",null,[e(l,{onClick:r,type:"primary",size:"default",icon:"Plus",disabled:!n(k).c3Id},{default:t(()=>[B("添加SPU")]),_:1},8,["disabled"]),e(V,{data:n(I),border:"",style:{width:"100%",margin:"10px 0"}},{default:t(()=>[e(a,{label:"序号",type:"index",width:"80",align:"center"}),e(a,{prop:"spuName",label:"SPU名称"}),e(a,{prop:"description",label:"SPU描述","show-overflow-tooltip":"true"}),e(a,{prop:"address",label:"SPU操作"},{default:t(({row:S})=>[e(l,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:R=>A(S)},null,8,["onClick"]),e(l,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:R=>c(S)},null,8,["onClick"]),e(l,{type:"primary",size:"small",icon:"View",title:"查看SPU列表",onClick:R=>$(S)},null,8,["onClick"]),e(u,{title:`您确认要删除${S.spuName}?`,width:"250px",icon:"Delete",onConfirm:R=>T(S)},{reference:t(()=>[e(l,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(D,{"current-page":n(y),"onUpdate:currentPage":_[0]||(_[0]=S=>O(y)?y.value=S:y=S),"page-size":n(U),"onUpdate:pageSize":_[1]||(_[1]=S=>O(U)?U.value=S:U=S),"page-sizes":[3,5,7,9],small:!0,background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:n(x),onSizeChange:C,onCurrentChange:w},null,8,["current-page","page-size","total"])],512),[[Q,n(v)==0]]),Y(e(Fe,{ref_key:"spu",ref:s,onChangeScene:d},null,512),[[Q,n(v)==1]]),Y(e(Be,{ref_key:"sku",ref:z,onChangeScene:d},null,512),[[Q,n(v)==2]])]),_:1})]),e(J,{modelValue:n(b),"onUpdate:modelValue":_[2]||(_[2]=S=>O(b)?b.value=S:b=S),title:"SKU列表"},{default:t(()=>[e(V,{border:"",data:n(i)},{default:t(()=>[e(a,{label:"SKU名字",prop:"skuName"}),e(a,{label:"SKU价格",prop:"price"}),e(a,{label:"SKU重量",prop:"weight"}),e(a,{label:"SKU图片"},{default:t(({row:S,$index:R})=>[H("img",{src:S.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Re)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const tl=Ne(je,[["__scopeId","data-v-7d8ecd42"]]);export{tl as default};
